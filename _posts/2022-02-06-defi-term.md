---
title: "내 마음대로 정리하는 DeFi 용어들"
author: Grizzly
categories:
  - Commons
tags:
  - Terminologies

sitemap :
changefreq : daily
priority : 1.0
# table of contents
toc: true # 오른쪽 부분에 목차를 자동 생성해준다.
toc_label: "table of content" # toc 이름 설정
toc_icon: "bars" # 아이콘 설정
toc_sticky: true # 마우스 스크롤과 함께 내려갈 것인지 설정
---

## Overview

개인적으로 블록체인(특히, DeFi)를 처음 접할 때, 가장 곤혹스러웠던 것이 이 분야에서 사용되는 용어들이었다. 원래, 블록체인에 큰 관심이 없던 내가 스터디를 하기로 마음먹은 후, 이것 저것 자료를 찾아봤지만, 용어의 장벽 때문에 아티클들을 술술 읽기 어려웠다
(지금도 쩔쩔매는 부분이기도 하지만 ㅎㅎ). DeFi를 학술적인 목적 혹은 그 이외의 목적으로 입문하는 사람들에게 조금이라도 도움이 되도록 그동안 틈틈히 정리해 놓았던 것을 포스팅해본다. 본디 개인적으로 공부할 목적으로 정리되어있다보니, 추후에도 쉽게 읽을 수 있도록 거의 대부분의 내용이 개조식으로 작성되어있다. 이 점 양해바란다.

**이 포스팅의 내용은 완전하지도 않거니와 잘 못된 내용을 포함할 수 있다.** 이에 대해서는 앞으로 지속적으로 업데이트를 할 예정이니, 혹시 이 글을 읽는 독자가 있다면 기탄없이 의견을 전달해주길 바란다:D

## Coin vs. Token

- 코인은 기반 블록체인이 있음. 예를 들어, 이더리움의 ether,  솔라나의 sol 등.
- 코인은 화폐로써 기능을 해야 함.
- 토큰은 기반 블록체인보다, 스마트 컨트랙트에 의존적임. 예를 들어, 이더리움의 ERC-20 등.
- 토큰은 화폐로써의 기능 이외에도 다양한 기능을 지원할 수 있음.

## 암호화폐 거래소(Cryptocurrency exchange/market)

- 암호화폐와 실제 화폐를 환전.
- 국내 주요 거래소: 업비트, 빗썸, 코인원, 코빗

## DeFi(Decentralized Finance)

- 어떤 특정 형태의 거래 방법이나, 마켓을 지칭하는 용어가 아님.
- 블록체인 상에서 (스마트컨트랙트를 기반으로) 발생하는 모든 거래를 통칭하는 용어라고 보는 것이 정확할 듯.
- 일반적으로 암호화폐 거래소는 실제 화폐(현금)과 암호화폐를 교환해주는 역할을 함. 예를 들어, 현금을 예치하고, 비트코인을 구매한다던지...
- DeFi의 서비스 유형에는 여러 종류가 있음.
    - Dex, Swap
    - Wallet
    - Lending(대출)
    - Stable coin
- Dex(Decentralized Exchange)
    - 탈중앙화 암호화폐 거래소.
    - 업비트나, 빗썸과 같은 기존 거래소는 서버-클라이언트 모델을 사용하는 중앙화된 암호화폐 거래소(Cex).
    - Cex는 기본적으로 현금과 암호화폐를 교환하는 것이 주목적이기 때문에 어떤 암호화폐를 다른 암호화폐로 교환하기 위해서는 암호화폐를 현금과 하는 작업이 필수임.
    - 또한, Cex에서는 고객의 자산이 한 곳(서버)에 보관되기 때문에 해킹 등에 취약함 (마운트곡스, 빗썸 해킹 사례 등).
    - 반면, Dex에서는 스마트컨트랙트를 이용한 P2P 형식으로 거래가 이루어지며, 고객의 자산이 분산되어 있음.
    - 암호화폐간 거래를 할 때, 현금화할 필요가 없이 직접적으로 교환 가능.
    - 대부분의 탈중앙화 시스템이 그렇듯 Dex도 관리나 운영 주체에 대한 신뢰성을 확보하기 어려움.
    - 해킹으로부터 완전히 자유롭지는 않음.
- NFT(Non-Fungible Token): 대체 불가한 토큰
    - 설명들이 추상적으로 적혀있는데, 일반적인 상품 거래를 예로 들면, 상품이 NFT이고 지불되는 금액이 화폐(코인,토큰)에 해당하는 듯.
        - 이름만 토큰이고, 사실상 물건이라고 봐야할 듯. 아니면 상품권?
    - 따라서, NFT를 구매하면, 이에 대한 소유권이나 저작권 등을 모두 한번에 획득할 수 있음 (구매한 상품이 내거니까, 또한 상품이 유일하게 진품이라는 사실도 증명됨).
        - 예를 들어, 가상의 토지 구매 등.
    - NFT의 기본적인 개념은 불가분적인 속성을 갖고 있었지만, 현재는 분할이 되는 NFT도 있다고 함.
    - 일반적인 대체가능한 토큰들은 동일한 가치를 갖는 또 다른 코인 혹은 토큰으로 교환될 수 있음.
    - NFT에 속하는 토큰들은 모두 NFT 속성을 가지고 있지만, 가치가 동일하지 않음.
    - NFT는 이더리움 블록체인에서 가장 활발하게 사용되고 있으며, ERC721 표준을 따름.
- Swap
    - 스왑 서비스를 제공하는 DeFi는 굉장히 많으며, 가장 보편적인 서비스 방식일 듯.
    - 스왑은 어떤 코인 혹은 토큰을 다른 코인 혹은 토큰으로 바꿔주는(swap)하는 것을 의미함.
    - 일반적으로 거래소에서 ‘현금→코인1→현금→코인2’이 방식에 비해 교환 과정이 단순하고, 가격도 저렴하다는 것이 특징이자 장점.
    - 단, 만약 스왑 서비스를 어떤 기업에서 운영한다면, 이 기업도 먹고 살아야하기 때문에 일정 수수료를 메김.
    - 사실상 swap이 dex의 한 형태라고 보는게 맞을 듯.
    - AMM의 가장 대표적인 서비스.
    - Swap을 비롯한 AMM 등 DeFi 서비스는 기본적으로 코인/토큰 간 거래이기 때문에 자신의 지갑을 생성한 후, 어느 정도 암호화폐 자산을 보유하고 있어야 시작할 수 있음.
- Loan, Lending
    - 추후 추가 예정.

## Peg

- 특정 화폐에 환율을 고정시키는 것?
- 예를 들어, Tether 블록체인에서는 페그된 토큰을 실제 화폐와 1:1 비율로 교환함.
    - USDT: 미국 달러에 페그된 Tether 토큰.
    - EURT: 유로에 페그된 Tether 토큰.

## Liquidity

- 자산 가격의 급격한 변화 없이 시장에서 자산을 매수/매도할 수 있는 정도
- 유동성=유동적 시작 or 유동적 자산.
- 시장이 유동적=매도하려는 사람과 매수하려는 사람이 언제 매칭됨.

![klayswap](/assets/images_post/2022-02-06-defi-term/klayswap.png)

## Slippage

- 거래를 원하는 가격에 유동성이 충분하지 않을 경우, 원하는 가격과 실제 체결가에 큰 차이가 발생함.
- 예를 들어, 유동성이 큰 비트코인과 유동성이 작은(시가 총액이 작은) 알트 코인 간 거래를 할 때, 많은 BTC를 알트 코인으로 (시장가로) 교환하려면,  거래량이 충분하지 않아 예상보다 비싼 가격에 거래들이 체결되는 것.
- 이는 시장가로 거래 시 오더북에 순차적으로 거래가 등록되기 때문인 듯.

## Order book

- (플랫폼 별로) 체결되지 않은 모든 거래가 정리된 것.
- 거래가 체결되거나 취소되면 그 즉시 오더북에서 해당 내역이 삭제됨.

![orderbook](/assets/images_post/2022-02-06-defi-term/orderbook.png)

- 오더북의 깊이(depth of orderbook)은 매수/매도의 주문량을 시각적으로 표현한 것 (즉, 유동성을 의미함).
- depth가 깊은 마켓이 유동적임.
- 오더북의 깊이를 읽는 방법은 단순함.
    - (앱에 따라 색의 차이는 있지만) 위 그래프를 보면, 녹색 부분은 밑으로 갈수록 가격이 싸지고, 붉은색 부분은 위로 올라갈 수록 가격이 비싸짐.
    - 즉, 사람의 심리상, 매물을 살(매수) 때는 가능한 싼 값에 사고 싶어하고, 팔(매도) 때는 가능함 비싸게 팔고 싶어함.
    - 녹색 부분이 밑으로 갈수록 가격이 싸진다는 것은 이용자들이 매물을 싼 값에 사고 싶어 저렴한 가격에 거래를 많이 걸어 놓는 것이고,
    - 붉은색 부분이 위로 올라갈 수록 가격이 올라간 다는 것은 이용자들이 매물을 비싸게 팔고 싶어, 비싼 가격에 거래를 많이걸어 놓은 것을 의미함.
    - 즉, 거래를 빠르게 성사시키고 싶다면, 매수와 매수의 시세가 일치하는 지점(즉, 현새 시세)에 거래를 걸어 놓아야 함.
- 매물의 가치가 점점 떨어지거나 점점 올라 갈 때, 거래를 빠르게 성사시키려면 어떻게 해야하는 가.
    - 매물의 가치가 하락할 때(하락장)는, 가능한 손실을 적게 보려는 사람의 심리상, 시세보다 비싼 가격에 매도가 많이 몰리고, 싼 가격의 매도가 적음 (즉, 오더북에서 매도의 깊이가 깊음).
    - 또한, 매도하려는 거래가 많지만, 매물의 가치가 떨어지기 때문에 매수 거래가 적을 것이기 때문에 오더북에서 매수의 깊이가 얕아짐.
    - 이와는 반대로, 매물의 가치가 상승할 때(상승장)는, 매수하려는 사람이 많이 때문에 매수의 깊이가 깊어지고, 매도의 깊이가 얕아짐.
    - 사람들이 가치가 올라가는 것을 팔고 싶어하지 않을 테니까.

## Bridge

- 어떤 블록체인의 코인 혹은 토큰을 이종 블록체인의 코인 혹은 토큰으로 전환하는 서비스.
- 일반적으로 Swap이나 AMM 서비스에서 이종 코인 혹은 토큰을 다룰 때는 해당 서비스의 기반 블록체인에서 사용가능한 토큰으로 전환해서 거래함.
- 예를 들어, Klaytn 네트워크에는 ‘오르비 브릿지(Orbit Bridge)’가 있음.
    - 이종 체인의 자산을 K 브릿지 자산으로 전환.
    - 만약, 리플(XRP)을 Klaytn 네트워크에서 같은 가치를 가지고 사용하려면, 브릿지를 거쳐 KXRP로 전환한 후 사용.
- 이런 유형의 기술을 IBC (Inter-Blockchain Communication)이라 함.

## Automated Market Maker (AMM)

- 유동성이 언제나 자동으로 제어되는 시장.
- 자산의 가격이 자동으로 책정됨. 암호화폐 시장에서는 코인 혹은 토큰의 시세가 자동으로 결정됨.
- 위 조건만 만족하면 무엇이든 AMM이라 할 수 있음.
- 많은 AMM 서비스가 발생하고 없어지고를 반복하고 있음. 대부분의 서비스들은 같은 이론을 바탕에 두고 있지만, trader를 유치하기 위해 사용하는 단어를 게임처럼 재밌게 바꿈. 예: 빵굽기 등.
- 기본적인 이론 외에도 서비스마다 특색있는 기능들을 제공하기도 하며, 여러 플랫폼이나 코인/토근과 연계하여 복잡한 기능들을 제공하기도 함.
- 구성원
    - Liquidity provider(LP): 유동성 풀에 2개 이상의 자산을 공급하는 자. 발생하는 거래에 대한 수수료를 받음.
        - 예: 유동성 풀에 이더와 리플을 쌍으로 공급.
        - 대개의 경우, DeFi 서비스들은 초기에 유동성이 부족하기 때문에 LP가 매우 중요한 역할을 함.
        - 특히, LP가 더 많은 유동성을 공급할 수록 더 많은 수수료를 지급함.
        - 서비스가 성숙할 수록 이용자 수도 증가하고, 유동성이 안정화가 되기 때문에 LP의 수수료가 줄어듦.
        - 이 때문에 (서비스의 신뢰성과 관계없이) 초기 DeFi만 찾아다니면서 LP 역할로 수익을 챙기는 전문투자자도 있음.
    - Trader: 풀 내의 자산을 다른 자산으로 교환하려는 자. LP에게 수수료를 지급. 예: 개미
    - Arbitrager: AMM의 교환 자산과 법정화폐 간 시세를 맞추는 자?????
- 유동성이 충분해야 slippage가 적게 발생하고, 안정성을 느낀 이용자들이 더 많이 유치되어 거래량이 늘어남.
- 유동성 제어 방식에 의한 AMM 유형
    - CFMM(Constant Function Market Maker)
        - CPMM(Constant Product Maket Maker)
        - CSMM(Constant Sum Market Maker)
        - CMMM(Constant Mean Market Maker)
    - Hybrid CFMM
    - Curve

## Constant Product-Market Maker(CPMM)

- 원문은 비탈릭 부테린의 2018년 포스팅이고, UniSwap(v1)이 이 이론에 기초해 Defi를 구현하면서 유명해짐.
- UniSwap의 whitepaper에 구체적인 구현 방법이 제시되어 있음.
    - 단순한 수식들이 사용되고 있지만, 약간 해석이 필요함.
- x * y=k로 대표되는 constant product AMM에 대해 간단하게 적어봄.
- x는 마켓(유동성 풀)에 올라온 A 토큰의 양.
- y는 마켓(유동성 풀)에 올라온 B 토큰의 양.
- 마켓은 위 공식으로 표현되는 invariant를 만족함.
- 사실 수요와 공급에 대한 아주 기초적인 식임.

![cpmm](/assets/images_post/2022-02-06-defi-term/cpmm.png)

- 상수 k에 대해 2개의 토큰은 위 그림과 같은 관계를 유지하며, 2개 토큰 사이의 교환율을 알 수 있음.
- Case #1
    - 만약 마켓에 B 토큰 매물이 많으면 자연스럽게 B 토큰의 (A 토큰으로 계산되는)시세가 저렴해짐.
    - 따라서, 조금의 A 토큰을 가지고 많은 B 토큰을 획득 할 수 있음.
    - 위 그림에서 Old position이 왼쪽 위에 있고, New position이 상대적으로 오른쪽 아래에 있는 경우.
- Case #2
    - 만약 마켓에 B 토큰 매물이 적으면 자연스럽게 B 토큰의 (A 토큰으로 계산되는)시세가 비싸짐.
    - 따라서, 많은 A 토큰을 가지고 조금의 B 토큰만을 획득할 수 있음.
    - 위 그림에서 Old position이 그래프의 중앙이나 오른쪽 에 위치하고, New position이 상대적으로 더 오른쪽 아래 있는 경우.
- 이때 환율은 이동된 2개 점 사이의 기울기로 표현될 수 있음.
- 많은 양을 한번에 거래하려할 때, 큰 손해를 보게됨 (slippage). 이 때문에 대부분의 서비스들은 limit order를 설정하거나 최소 보장금액 정도를 제시함.
- 이론적으로는  유동성이 조금이라도 있다면, 거래가 가능함.

## DeFi의 수익 구조

- DeFi 서비스가 다양한만큼 각 서비스가 구현한 수익구조가 다름. 이 중 직접경험하거나 학습한 몇 가지 수익구조에 대해 적은 것.
- AMM
    - LP들은 pool에 유동성을 공급하는데, 이때 기본적으로 서로 다른 2개의 토큰 혹은 코인을 동시에 deposit하도록 되어 있음.
    - 이때, deposit 비율은 AMM에 의해 결정된 토큰/코인 간 비율이 적용됨.
        - 예를 들어, 2022년 1월 13일 KlaySwap에서 KLAY와 KUSDT를 deposit했는데, 이때 비율이 1:1.4 정도 되었음.
    - 이렇게 deposit을 하게 되면, LP는 해당 pool에 대하 지분을 갖게 되는데, 이를 흔히 LP token이라 함.
    - 추후, pool에서 내 자산을 withdraw할때, 자신의 지분인 LP token을 제시한 만큼 가져가는 구조임.
        - 유동성을 공급할 때, 2개의 코인/토큰을 쌍으로 공급했기 때문에 withdraw를 하면 그때의 비율에 맞춰서 2개의 코인/토큰을 동시게 withdraw하게 됨.
    - 그리고 pool에 유동성을 공급하면 (쉽게 말해 은행에 돈을 예금하면), 이자가 발생함. 이자 역시 토큰의 일종임.
        - 예를 들어, KlaySwap의 경우, KSP가 여기에 해당함.
        - 즉, deposit하는 것만으로도 수익을 얻을 수 있음.
        - 이자에 해당하는 이 토큰은 DeFi 서비스가 매일 일정량 공급하고, LP들이 지분에 따라 이를 나눠 갖는 것.
    - AMM 매커니즘에 의해 시세가 변하는 시나리오는 다음과 같음.
        - 예를 들어, ETH/TETH pool이 있다고 할 때, LP들은 이 pool 항상 코인/토큰을 쌍으로 공급해야 함.
        - 만약 한쪽의 시세가 오른다면(이를테면, ETH) 사람들(LP가 아닌 일반 사용자)은 가지고 있는 TETH를 ETH로 교환(swap)할 것. 당연히 pool의 자원을 이용하는 것.
        - 교환한 사용자는 TETH 대신 ETH를 획득할 것이고, pool은 TETH를 공급받은 대신 ETH가 없어짐.
        - 이로 인해 TETH와 ETH의 물량에 변화가 발생하고, 시세가 변화하는 것.

## Flash Loan

추후 추가 예정


## 마치며
선술한 것과 같이, 이 글은 완전하지도 않고, 적혀있는 모든 내용이 정확하지도 않다. 이에 대한 보완은 내가 블록체인 스터디를 계속하는한 지속적으로 업데이트될 것이니 양해바란다. 그저, 이 포스트가 입문자에게 조금이라도 도움이 될 수 있길 바랄 뿐이다.

## References

- Abraham Othman, “Automated Market Making: Theory and Practice,” Thesis, Carnegie Mellon University, 2012.
- Guillermo Angeris, Tarun Chitra, “Improved Price Oracles: Constant Function Market Makers,” arXiv, 2020.
- Yi Zhang, Xiaohong Chen, Daejun Park, “Formal Specification of Constant Product (x * y=k) Market Maker Model and Implementation,” arXiv, 2018.
- Jiahun Xu, Krzysztof Paruch, Simon Cousaert, Yebo Feng, “SoK: Decentralized Exchanges(DEX) with Automated Market Maker (AMM) Protocols,” arXiv 2021.
- [https://academy.binance.com/ko/articles/what-is-an-automated-market-maker-amm](https://academy.binance.com/ko/articles/what-is-an-automated-market-maker-amm)
- [https://academy.binance.com/ko/articles/liquidity-explained](https://academy.binance.com/ko/articles/liquidity-explained)
- [https://academy.binance.com/ko/articles/what-are-flash-loans-in-defi](https://academy.binance.com/ko/articles/what-are-flash-loans-in-defi)
- [https://medium.com/curg/같지만-다른-amm-대체-다들-뭐가-다르길래-계속-생겨나는-건가요-41c98dc63000](https://medium.com/curg/같지만-다른-amm-대체-다들-뭐가-다르길래-계속-생겨나는-건가요-41c98dc63000)
- [https://www.leafcats.com/311](https://www.leafcats.com/311)
- [https://www.leafcats.com/321](https://www.leafcats.com/321)